<div class="container-fluid">
    <div class="row">
        <div class="col-sm-12">
            <div class="card">
                <dx-data-grid [dataSource]="customersSource" [showBorders]="true" [rtlEnabled]="lang"
                              [hoverStateEnabled]="true"
                              [focusedRowEnabled]="true"
                              (onFocusedRowChanged)="onFocusedRowChanged($event)">
                    <dxo-paging [enabled]="true" [pageSize]="10"></dxo-paging>
                    <dxo-header-filter [visible]="true"></dxo-header-filter>
                    <dxo-search-panel [visible]="true"></dxo-search-panel>
                    <dxi-column dataField="code" [caption]="'Code'|translate"></dxi-column>
                    <dxi-column dataField="name" [caption]="'Name'|translate"></dxi-column>
                    <dxi-column dataField="isActive" dataType="boolean" [caption]="'Is Active'|translate"></dxi-column>
                </dx-data-grid>
                <div [hidden]="!currentUser" class="dx-field m-15">
                    <div class="dx-field-value">
                        <dx-button
                                [(rtlEnabled)]="lang"
                                class="btn-success send"
                                icon="fa fa-save"
                                (click)="saveCustomerPermissions()"
                                text="Save ">
                        </dx-button>
                    </div>
                </div>
                <div [hidden]="!currentUser" class="dx-field m-15">
                    <div class="dx-field-value">
                        <dx-check-box [value]="!canChangePermissions" (onValueChanged)="filterItems($event)">
                            Only Show filtered Items
                        </dx-check-box>
                    </div>
                </div>

                <dx-data-grid
                    #items
                    [(selectedRowKeys)]="selectedItems"
                    keyExpr="code"
                    [hidden]="!currentUser"
                    [filterValue]="filterValue"
                    [dataSource]="source"
                    [rtlEnabled]="lang"
                    [columnAutoWidth]="true"
                    [hoverStateEnabled]="true">
                    <dxo-paging [enabled]="true" [pageSize]="10"></dxo-paging>
                    <dxo-header-filter [visible]="true"></dxo-header-filter>
                    <dxo-search-panel [visible]="true"></dxo-search-panel>
                    <dxo-group-panel [visible]="true"></dxo-group-panel>
                    <dxo-selection mode="multiple" showCheckBoxesMode="always"></dxo-selection>
                    <dxo-grouping [autoExpandAll]="false" expandMode="buttonClick"></dxo-grouping>
                    <dxi-column dataField="code" [caption]="'Code'|translate"
                                [formItem]="{visible: false}"></dxi-column>
                    <dxi-column dataField="nameAr" [caption]="'Name Ar'|translate"></dxi-column>
                    <dxi-column dataField="unitNameAr" [caption]="'Unit'|translate"></dxi-column>
                    <dxi-column dataField="size" [caption]="'Size'|translate"></dxi-column>
                    <dxi-column dataField="rankingCode" groupIndex="0" groupCellTemplate="rankingTemplate"
                                [caption]="'Ranking'|translate" [formItem]="{visible: false}"></dxi-column>
                    <dxi-column dataField="materialCode" groupIndex="1" groupCellTemplate="materialTemplate"
                                [caption]="'Material'|translate" [formItem]="{visible: false}"></dxi-column>
                    <div *dxTemplate="let ranking of 'rankingTemplate'">
                        <dx-check-box (onValueChanged)="rankingRowSelected($event,ranking)"
                                      [value]="getRankingSelectValue(ranking)  || false"></dx-check-box>
                        {{ranking.value}}
                    </div>
                    <div *dxTemplate="let material of 'materialTemplate'">
                        <dx-check-box [value]="getMaterialSelectValue(material) || false"
                                      (onValueChanged)="materialRowSelected($event,material.key,material.data.items,material.data.collapsedItems,material.component)"></dx-check-box>
                        {{material.value}}
                    </div>
                </dx-data-grid>
            </div>
        </div>
    </div>
</div>
